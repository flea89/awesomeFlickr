"use strict";angular.module("potatoFlickrApp",["ngRoute","ngAnimate","ngSanitize"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"feedsController",resolve:{feeds:["feedService",function(a){return a.getFeeds("")}]}}).when("/feedDetail/:feedIndex",{templateUrl:"views/feedDetail.html",controller:"FeeddetailCtrl",resolve:{feed:["feedService","$route",function(a,b){return a.getFeed(b.current.params.feedIndex)}]}}).otherwise({redirectTo:"/"})}]),angular.module("potatoFlickrApp").run(["$rootScope","$location",function(a,b){a.$on("$locationChangeSuccess",function(b,c){a.animationDirection=c.match(/\/feedDetail\//)?"reverse":""}),a.$on("$routeChangeError",function(){b.path("/")})}]),angular.module("potatoFlickrApp").controller("feedsController",["$scope","feeds","feedService",function(a,b,c){a.feeds=b,a.$watch("tag",function(b,d){b!==d&&(a.noNewFeeds=!1,c.getFeeds(a.tag).then(function(b){a.feeds=b,a.tagName=a.tag}))}),a.loadMore=function(){c.loadMore().then(function(b){a.noNewFeeds=b.length===a.feeds.length?!0:!1,a.feeds=b})}}]),angular.module("potatoFlickrApp").factory("feedService",["$http","$q","authorService",function(a,b,c){var d,e=[];return{getFeeds:function(f){var g=b.defer();return e.tag=f,d=f,a.jsonp("http://api.flickr.com/services/feeds/photos_public.gne",{params:{tagsMode:"all",format:"json",tags:f,jsoncallback:"JSON_CALLBACK"}}).success(function(a){e=a.items,e.forEach(function(a){c.addAuthorDetail(a)}),g.resolve(e)}).error(function(){g.reject("error")}),g.promise},getFeed:function(a){var c=b.defer();return e.length>0?c.resolve(e[a]):c.reject(),c.promise},loadMore:function(){var f=b.defer();return a.jsonp("http://api.flickr.com/services/feeds/photos_public.gne",{params:{tagsMode:"all",format:"json",tags:d,jsoncallback:"JSON_CALLBACK"}}).success(function(a){if(Array.isArray(a.items)){var b=a.items.filter(function(a){for(var b=!1,c=0;c<e.length;c++)if(e[c].link===a.link){b=!0;break}return!b});b.forEach(function(a){c.addAuthorDetail(a)});var d=e.concat(b);e=d,f.resolve(d)}else f.reject()}).error(function(){f.reject()}),f.promise}}}]),angular.module("potatoFlickrApp").directive("topbar",["$rootScope","$location",function(a,b){return{templateUrl:"directivesTemplates/topbarTemplate.html",restrict:"A",scope:{tag:"="},link:function(c){c.submit=function(){c.tag=c.search},c.enableSearch=!0,a.$on("$routeChangeSuccess",function(){c.enableSearch=b.path().match(/^\/feedDetail\//)?!1:!0})}}}]),angular.module("potatoFlickrApp").directive("previewPost",function(){return{templateUrl:"directivesTemplates/postPreview.html",restrict:"A",scope:{imgUrl:"@",title:"@",date:"@",authorName:"@",index:"@",feedLink:"@",profileLink:"@"},link:function(){}}}),angular.module("potatoFlickrApp").controller("MainController",["$scope",function(){}]),angular.module("potatoFlickrApp").controller("FeeddetailCtrl",["$scope","feed",function(a,b){a.feed=b}]),angular.module("potatoFlickrApp").factory("authorService",["$http",function(a){return{addAuthorDetail:function(b){a.jsonp("http://api.flickr.com/services/rest/",{params:{method:"flickr.people.getInfo",api_key:"dd7d2fcd63a0e3c724d3c76622a1a547",format:"json",user_id:b.author_id,jsoncallback:"JSON_CALLBACK"}}).success(function(a){a.person?(b.authorName=a.person.realname&&a.person.realname._content||a.person.username&&a.person.username._content||"awesome name",b.profileLink=a.person.photosurl._content):(b.authorName="awesome name",b.profileLink="#")})}}}]),angular.module("potatoFlickrApp").directive("gplus",function(){return{template:'<div class="google-plus"><div class="g-plusone" data-href="{{link}}" data-annotation="none" data-size="{{size}}"></div></div>',restrict:"EA",scope:{link:"@",size:"@",annotation:"@"},replace:!0,link:function(){gapi.plusone.go("google-plus")}}});